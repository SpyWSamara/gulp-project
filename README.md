# {{name}}

Автоматизированная сборка HTML-проекта.

## Содержание

- [Основные возможности](#about)
- [Подготовка к работе](#start)
- [Структура проекта](#structure)
- [Настройки](#settings)
- [Инициализация и запуск](#build)
- [Работа с файлами](#process)
- - [HTML-файлы](#html)
- - [SASS-файлы](#sass)
- - [JS-файлы](#js)
- - [Инициализация Swiper](#swiper)
- - [Изображения](#images)
- - [Конвертация SVG в Base64](#svg-base64)
- - [Иконки Icomoon](#icomoon)
- - [Шаблоны](#templates)
- - [Подключение библиотек и плагинов](#vendor)
- [Загрузка файлов на сервер](#deploy)
- [Создание ZIP-архивов](#zip)
- [Аудит страниц (Lighthouse)](#lighthouse)
- [Включенные библиотеки](#addons)
- [История изменений](#changelog)

<a name="about"></a>

## Основные возможности

- Конкатенация, минификация и компановка HTML и JS-файлов.
- Компиляция SCSS в CSS файлы, установка браузерных префиксов и группировка медиа-запросов.
- Генерация карт кода (sourcemaps) для CSS и JS файлов (опционально).
- Оптимизация растровых (JPG, PNG, GIF) и векторных (SVG) изображений.
- Конвертация SVG-файлов в Base64 и импорт в CSS.
- Конвертация изображений в формат WebP (опционально).
- Рендеринг переменных и итерация в HTML.
- Автоматическая компиляция списка файлов проекта, используемых библиотек и компонентов.
- Импорт иконок Icomoon в SASS.
- Слежение за файлами (watch) и автоматическая перекомпиляция файлов.
- Создание ZIP-архивов с исходными и скомпилированными файлами.
- Загрузка файлов на сервер по FTP.

<a name="start"></a>

## Подготовка к работе

Для инициализации и запуска проекта необходимо наличие в системе [Node.js](https://nodejs.org/). Если он не установлен, произведите установку с [официального сайта](https://nodejs.org/).

Сборка проекта осуществляется с использованием последней версии [Gulp](https://gulpjs.com/).  Перед началом работы убедитесь, что Gulp установлен с помощью команды `gulp -v`.

Для установки Gulp воспользуйтесь командой:

`npm install --global gulp-cli`

**Примечание:**
Если ранее вы уже устанавливали Gulp глобально, удалите его ([подробнее](https://medium.com/gulpjs/gulp-sips-command-line-interface-e53411d4467)) и установите пакет `gulp-cli`:

`npm rm --global gulp`
`npm install --global gulp-cli`

<a name="structure"></a>

## Структура проекта

```
gulp-project/                       # Корневая директория
├── gulp                            # Файлы Gulp
│   ├── helpers                     # Вспомогательные функции
│   │   ├── args.js                 # Преобразование консольных параметров в настройки
│   │   ├── now.js                  # Получение объекта с текущей датой
│   │   └── tasks.js                # Генерация задач для Gulp
│   ├── tasks                       # Таски Gulp для обработки файлов
│   │   ├── bootstrap.js            # Сборка Bootstrap
│   │   ├── browser.js              # Запуск браузера после загрузки файлов на сервер
│   │   ├── build.js                # Компиляция исходных файлов
│   │   ├── clean.js                # Очистка временных директорий
│   │   ├── clear-cache.js          # Очистка кэша
│   │   ├── common.js               # Формирование списка страниц проекта
│   │   ├── default.js              # Задача по умолчанию
│   │   ├── deploy.js               # Загрузка файлов на сервер и открытие браузера
│   │   ├── dev.js                  # Запуск сборки, слежения за файлами и синхронизации с браузером
│   │   ├── html.js                 # Компиляция HTML файлов
│   │   ├── icomoon.js              # Автоматическое добавление иконок Icomoon в проект
│   │   ├── images.js               # Пакетное сжатие и преобразование изображений
│   │   ├── js.js                   # Компиляция JS-файлов
│   │   ├── reload.js               # Перезагрузка браузера
│   │   ├── sass.js                 # Компиляция SASS-файлов
│   │   ├── steady.js               # Копирование статических файлов
│   │   ├── upload.js               # Установление FTP-соединения и передача файлов
│   │   ├── steady.js               # Копирование статических файлов
│   │   ├── vendor.js               # Копирование файлов библиотек и плагинов
│   │   ├── watch.js                # Слежение за изменением исходных файлов
│   │   ├── webserver.js            # Запуск Browsersync
│   │   └── zip.js                  # Создание zip-архивов с исходными и выходными файлами
│   ├── config.js                   # Глобальные настройки проекта
│   ├── defaults.js                 # Параметры сборки по умолчанию
│   └── ftp.js                      # Настройки FTP
├── src                             # Исходные файлы
|   ├── common                      # Список страниц проекта (генерируется автоматически)
|   ├── data                        # JSON-файлы для хранения контента страниц
|   ├── fonts                       # Файлы шрифтов
|   ├── icomoon                     # Файлы Icomoon
|   ├── images                      # Изображения
|   ├── import                      # Зависимости компонентов
|   ├── includes                    # Подключаемые HTML-файлы
|   │   ├── components              # HTML-компоненты
|   │   ├── forms                   # Формы
|   │   ├── items                   # Итерируемые файлы
|   │   ├── modals                  # Модальные окна
|   │   ├── partials                # Фрагменты
|   │   ├── sections                # Секции
|   |   ├── footer.html             # Подвал
|   |   ├── header.html             # Шапка
|   |   └── sidebar.html            # Сайдбар (боковая колонка)
|   ├── javascripts                 # Файлы JavaScript
|   │   ├── base                    # Глобальные файлы (по умолчанию компилируются в один файл)
|   │   ├── components              # Компоненты (по умолчанию компилируются в отдельные файлы)
|   │   ├── partials                # Подключаемые файлы
|   │   └── polyfills               # Полифиллы для браузеров
|   ├── styles                      # Файлы SASS
|   │   ├── base                    # Глобальные файлы (по умолчанию компилируются в один файл)
|   │   ├── components              # Компоненты (по умолчанию компилируются в отдельные файлы)
|   │   ├── icons                   # Иконки
|   │   ├── partials                # Подключаемые файлы
|   │   ├── vendor                  # Исходные файлы библиотек и плагинов
|   |   ├── _config.scss            # Глобальные настройки
|   |   ├── _icons.scss             # Иконки проекта
|   |   └── _partials.scss          # Дополнительные файлы
|   ├── swiper                      # JSON-файлы с параметрами Swiper
|   ├── templates                   # Папка для шаблонов (Handlebars, Mustache и пр.)
|   ├── vectors                     # SVG-файлы для встраивания в CSS
|   ├── vendor                      # Библиотеки и плагины
|   ├── ├── css                     # Файлы CSS
|   ├── ├── fonts                   # Файлы шрифтов
|   ├── └── js                      # Файлы JavaScript
|   └── home.html                   # Главная страница
├── .editorconfig                   # Настройки для редактора кода
├── .gitignore                      # Список игнорируемых файлов для git
├── gulpfile.js                     # Основной файл Gulp
├── package-lock.json               # Требуется для запуска команды `npm ci`
├── package.json                    # Файл package.json
└── README.md                       # Информация о проекте
```

<a name="settings"></a>

## Настройки

Глобальные настройки проекта расположены в директории:

`./gulp/config.js`

**Настройки проекта**

Параметр  | Назначение
------------- | -------------
title  |  Полное название проекта. Передается в глобальную переменную @@​title, которую можно использовать на всех HTML страницах проекта
name  |  Сокращенное название проекта, наследуется из файла `package.json`
files  | Названия для файлов проекта
common  |  Настройки для списка страниц проекта
paths  |  Пути до файлов проекта
webserver  |  Параметры `browser-sync`
compressors  | Плагины для компрессии изображений
repo  | Ссылка на репозиторий проекта, наследуется из файла `package.json`

<a name="build"></a>

## Инициализация и запуск

```shell
# Перейдите в папку с проектом
cd /path/to/project/

# Установите необходимые зависимости
npm ci

# Запустите сборку
gulp
```

**Запуск с параметрами**

Основные параметры можно передать перед запуском в консоли:

```shell
# Запустите сборку с параметрами
gulp --[param1] value1 --[param2] value2

# Пример запуска с параметрами
gulp --minify css,js --host demo --zip
```

**Список доступных параметров**

Параметр  | По умолчанию | Назначение
------------- | ------------- | -------------
merge  | false | Объединять глобальные файлы и компоненты в один файл
zip  | false | Создать zip-архив с файлами проекта
sourcemaps  | false | Создавать карты кода для JS и CSS файлов
minify  | css | Минифицировать файлы. Значения передаются через символ запятой `,` одной строкой (пример: `--minify css,js,html`).
webp  | false | Конвертировать все изображения в формат WebP
git  | false | Добавить ссылку на репозиторий на страницу со списком файлов
host  | 'default' | Объект с настройками FTP для загрузки файлов (из файла `ftp.js`)

Параметры по умолчанию задаются в файле `/gulp/defaults.js`.

<a name="process"></a>

## Работа с файлами

Для удобной работы с HTML и JS-файлами (конкатенация, итерация и т.д) вы можете использовать операторы [gulp-file-include](https://www.npmjs.com/package/gulp-file-include):

- @@​include
- @@​if
- @@​for
- @@​loop

Документация и примеры использования [здесь](https://www.npmjs.com/package/gulp-file-include).

<a name="html"></a>

### HTML-файлы

HTML-файлы размещены в корневой директории с исходными файлами `/src/`.

Для удобной работы с включаемыми HTML-файлами в папке `/src/includes/` предусмотрены вложенные поддиректории, однако вы можете их переименовывать, удалять и создавать новые на свое усмотрение.

<a name="sass"></a>

### SASS-файлы

Глобальный файл настроек SASS находится в папке `/src/styles/_config.scss`.

Вы можете создавать собственные переменные, миксины и функции и размещать их в файле `/src/styles/partials/_custom.css`, после этого они будут доступны глобально.

- Все файлы из директории `/src/styles/base` компилируются в один файл, название которого задается в глобальных параметрах `config.files.css`.
- Все файлы из директории `/src/styles/components` компилируются в отдельные файлы с сохранением названия.

> Если перед сборкой проекта передан параметр `--merge`, файлы из директорий `/src/styles/base` и `/src/styles/components` конкатенируются в один файл.

<a name="js"></a>

### JS-файлы

- Все файлы из директории `/src/javascripts/base` компилируются в один файл, название которого задается в глобальных параметрах `config.files.js`.
- Все файлы из директории `/src/javascripts/components` компилируются в отдельные файлы с сохранением названия.

> Если перед сборкой проекта передан параметр `--merge`, файлы из директорий `/src/javascripts/base` и `/src/javascripts/components` конкатенируются в один файл.

<a name="swiper"></a>

### Инициализация Swiper

Каждый экземпляр Swiper инициализируется с уникальным ID и сохраняется в глобальный JS-объект `window.swipers`.

1. В директории `/src/data` создайте JSON-массив с контентом для слайдов (например, `slider.json`). Название файла должно соответствовать ID свайпера.

**Пример файла `slider.json`:**

```json
[
    {
        "id": 1,
        "title": "One",
        "text": "I am first slide"
    }, {
        "id": 2,
        "title": "Two",
        "text": "I am second slide"
    }, {
        "id": 3,
        "title": "Three",
        "text": "I am third slide"
    }
]
```

2. В директории `/src/includes/items` создайте HTML-файл с разметкой для отдельного слайда (`slide.html`).

**Пример файла `slide.html`:**

```html
<div class="slide slide--@@id">
    <div class="slide__title">@@title</div>
    <div class="slide__text">@@text</div>
</div>
```

3. В директории `/src/swiper` создайте JSON файл, содержащий параметры для свайпера. Название файла должно соответствовать ID свайпера.

**Пример файла `slider.json`:**

```json
{
    "slidesPerView": 1,
    "spaceBetween": 15,
    "loop": true,
    "breakpoints": {
        "768": {
            "slidesPerView": 2
        },
        "1200": {
            "slidesPerView": 4,
            "spaceBetween": 25
        }
    }
}
```

4. Вызовите компонент `swiper.html`, передав ему ID свайпера и название шаблона слайда:

```html
@@include('components/swiper.html', {
    "id": "slider",
    "template": "slide"
})
```

После инициализации вы сможете манипулировать экземпляром Swiper через объект `window.swipers['slider'].swiper`.

<a name="images"></a>

### Изображения

Переместите изображения в директорию `/src/images`.

>Параметры компрессии изображений задаются в глобальных настройках проекта `config.compressors`.

>Для конвертирования всех изображений в формат WebP передайте флаг `--webp` при сборке проекта.

<a name="svg-base64"></a>

### Конвертация SVG в Base64

Для конвертации SVG в Base64 и встраивания в CSS переместите нужное изображение в директорию `/src/vectors` и укажите в SASS путь до него.

<a name="icomoon"></a>

### Добавление иконок Icomoon

Для добавления иконок в проект распакуйте содержимое ZIP-архива с сайта [icomoon.io](https://icomoon.io/app/) в директорию `./src/icomoon`. После этого автоматически сгенерируются CSS-классы иконок.

Массив сгенерированных классов сохраняется в глобальную переменную `@@​icons`, которая доступна в HTML.

<a name="templates"></a>

### Шаблоны

Если вы используете JS-компиляторы для HTML (Handlebars, Mustache и т.п), для хранения шаблонов предусмотрена директория `/src/templates`.

Все файлы из неё копируются без изменения в папку с выходными файлами.

<a name="vendor"></a>

### Подключение библиотек и плагинов

Для подключения сторонних библиотек переместите в соответствующие директории: `/src/vendor` (JS и CSS-файлы) либо в `/src/styles/vendor` (исходные SASS-файлы).

<a name="deploy"></a>

## Загрузка файлов на сервер

Перед загрузкой файлов на сервер необходимо прописать настройки FTP соединения в файл `/gulp/ftp.js`.

**Пример файла ftp.js:**

```javascript
const pjson = require('../package.json');

module.exports = {
    default: {
        host: 'XXX.XX.XX.XX',
        user: 'username',
        password: '******',
        dest: `/httpdocs/domain.com/${pjson.name}/`,
        uri: `http://domain.com/${pjson.name}`
    }
};
```

Для установления соединения и загрузки файлов на сервер запустите команду:

`gulp deploy`

<a name="zip"></a>

## Создание ZIP-архивов

>Названия ZIP-архивов задаются в глобальных параметрах в объекте `config.files.zip`.

Для генерации ZIP-архивов с исходными и выходными файлами передайте параметр `--zip` перед сборкой проекта:

`gulp --zip`

<a name="lighthouse"></a>

## Аудит страниц (Lighthouse)

>[Google Lighthouse](https://github.com/GoogleChrome/lighthouse) – это инструмент аудита с открытым исходным кодом, который помогает разработчикам повысить производительность и доступность своих веб-проектов.

Отчеты Google Lighthouse генерируются на локальном сервере для каждой страницы проекта после запуска команды:

`gulp lighthouse`

<a name="addons"></a>

## Включенные библиотеки

- [jQuery](https://jquery.com/)
- [Bootstrap](https://getbootstrap.com/)
- [Swiper](https://swiperjs.com/)
- [lozad](https://apoorv.pro/lozad.js/)
- [animate.css](https://daneden.github.io/animate.css/)
- [fancybox](https://fancyapps.com/fancybox/3/)
- [simplebar](https://github.com/Grsmto/simplebar)
- [jQuery Mask](https://igorescobar.github.io/jQuery-Mask-Plugin/)
- [popper.js](https://popper.js.org/)
- [tippy.js](https://atomiks.github.io/tippyjs/)

<a name="changelog"></a>

## История изменений

**1.1.0**
- Добавлено: аудит страниц через Google Lighthouse.
- Исправлено: удаление неиспользуемого кода, исправление мелких ошибок.

**1.0.0**
- Первый стабильный релиз.

## Лицензия

[The MIT License (MIT)](LICENSE)