@import '../config';
@import '../partials';

/* Form */

$input-size: round($input-font-size * $input-factor);
$input-height: $input-font-size * $line-height + nth($input-padding, 1) * 2 + $input-border-width * 2;

input[type="text"],
input[type="tel"],
input[type="email"],
textarea,
button {
    appearance: none;
    outline: 0!important;
    box-shadow: none!important;
}

input[type="text"],
input[type="tel"],
input[type="email"],
textarea {
    @include autofill() {
        box-shadow: 0 0 0 30px white inset !important;
    }

    &:focus {
        border-color: $primary;
    }

    @include placeholder() {
        color: $placeholder-color;
    }

    .js-focus & {
        @include placeholder() {
            color: transparent;
        }
    }
}

input[type="text"],
input[type="tel"],
input[type="email"],
textarea,
.select__input,
.select__dropdown {
    width: 100%;
    max-width: 100%;
    font-size: $input-font-size;
    padding: $input-padding;
    border-radius: $input-radius;
    border: $input-border-width solid $input-border-color;
    @include transition(border-color);

    @include mo(xs) {
        padding-left: round(nth($input-padding, 2) * $input-padding-xs-factor);
        padding-right: round(nth($input-padding, 2) * $input-padding-xs-factor);
    }
}

textarea {
    min-height: $textarea-height;
}

label {
    max-width: 100%;
    display: inline-block;
    margin-bottom: $form-gutter / 2;
}

input[type="checkbox"],
input[type="radio"],
input[type="file"],
select {
    visibility: hidden;
    display: none;
}

input[type="checkbox"],
input[type="radio"] {
    + label {
        position: relative;
        cursor: pointer;
        padding-left: $input-size * $input-offset-factor;
        margin-bottom: 0;

        &:before, &:after {
            position: absolute;
            top: ($input-font-size * $line-height - $input-size) / 2;
            left: 0;
            @include transition();
        }

        &:before {
            content: '';
            border: $input-border-width solid $border;
            border-radius: $input-radius / 2;
            width: $input-size;
            height: $input-size;
            display: inline-flex;
            vertical-align: middle;
        }

        &:after {
            content: '';
            display: block;
            opacity: 0;
            @include transition();
        }
    }

    &:checked {
        + label {
            &:after {
                opacity: 1;
            }
        }

        &.switch {
            + label {
                &:before {
                    background: $checkbox-color;
                }
                &:after {
                    background: $white;
                    transform: translate($input-size * (3 - $switcher-factor) / 2, $input-size * (1 - $switcher-factor) / 2);
                }
            }
        }
    }

    &:disabled {
        + label {
            opacity: .35;
            pointer-events: none;
        }
    }
}

input[type="checkbox"] {
    + label {
        &:after {
            width: round($input-size / 4);
            height: round($input-size / 2);
            transform-origin: 50% 50%;
            border: solid $checkbox-color;
            border-width: 0 $checkbox-thickness $checkbox-thickness 0;
            transform: rotate(45deg) translate($input-size / 2.5, -$input-size / 8);
        }
    }
    &:checked {
        + label {
            &:before {
                border-color: $checkbox-color;
            }
        }
    }

    &.switch {
        + label {
            padding-left: $input-size * ($input-offset-factor + 1);

            &:before {
                width: $input-size * 2;
                border-radius: $input-size;
            }

            &:after {
                opacity: 1;
                width: $input-size * $switcher-factor;
                height: $input-size * $switcher-factor;
                border: 0;
                border-radius: 50%;
                background: $checkbox-color;
                transform: translate($input-size * (1 - $switcher-factor) / 2, $input-size * (1 - $switcher-factor) / 2);
            }
        }
    }
}

input[type="radio"] {
    + label {
        &:after {
            width: $input-size * $radio-factor;
            height: $input-size * $radio-factor;
            border-radius: 50%;
            background: $radio-color;
            transform: translate($input-size / 4, $input-size / 4);
        }
        &:before {
            border-radius: 50%;
        }
    }

    &:checked {
        + label {
            &:before {
                border-color: $radio-color;
            }
        }
    }

    &:disabled {
        + label {
            opacity: .35;
            pointer-events: none;
        }
    }
}

input[type="file"] {
    + label {
        width: auto;
        border: $input-border-width solid $input-border-color;
        padding: $input-padding;
        border-radius: $input-radius;
        cursor: pointer;
        margin: 0;
        @include truncate();
        @include transition(border-color);

        @include mo(xs) {
            padding-left: round(nth($input-padding, 2) * $input-padding-xs-factor);
            padding-right: round(nth($input-padding, 2) * $input-padding-xs-factor);
        }
    }

    .is-focused &,
    .is-checked & {
        + label {
            border-color: $primary;
        }
    }

    .is-checked & {
        + label {
            color: $primary;
        }
    }
}

.js-focus {
    label {
        position: absolute;
        top: nth($input-padding, 1);
        left: nth($input-padding, 2);
        transition: font-size .15s ease-in-out, top .15s ease-in-out;
        margin-bottom: 0;

        @include mo(xs) {
            left: round(nth($input-padding, 2) * $input-padding-xs-factor);
        }
    }

    &.is-focused,
    &.is-checked {

        label {
            top: nth($input-padding, 1) / 2;
            font-size: $input-font-size * .6;
        }

        input,
        textarea {
            padding: nth($input-padding, 1) * 1.5 nth($input-padding, 2) nth($input-padding, 1) / 2;

            @include mo(xs) {
                padding-left: round(nth($input-padding, 2) * $input-padding-xs-factor);
                padding-right: round(nth($input-padding, 2) * $input-padding-xs-factor);
            }
        }
    }
}

.select {
    position: relative;

    &__element {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: $input-height;
        appearance: none;
        opacity: 0;

        @include mo(xs) {
            display: block;
            visibility: visible;
            z-index: 2;
        }
    }

    &__input {
        $select-angle-size: $input-height * $select-angle-factor;
        $select-angle-real-size: $select-angle-size * sin(45deg) + $select-angle-size * cos(45deg);
        $select-angle-position: $select-angle-real-size / 2;

        width: $select-width;
        position: relative;
        z-index: 1;
        @include truncate();
        color: $placeholder-color;
        padding-right: $select-angle-size + nth($input-padding, 2) * 2!important;
        cursor: pointer;
        @include transition();

        &:after {
            content: '';
            width: $select-angle-size;
            height: $select-angle-size;
            position: absolute;
            top: calc(50% - #{$select-angle-real-size / 2 - $input-border-width});
            right: nth($input-padding, 2);
            border: solid $select-angle-color;
            border-width: 0 $select-angle-border-width $select-angle-border-width 0;
            display: block;
            transform: rotate(45deg);
            transform-origin: $select-angle-position $select-angle-position;
            @include transition();
        }

        .is-focused &,
        .is-opened & {
            color: $primary;
            border-color: $select-color;

            &:after {
                border-color: $select-color;
                transform: rotate(-135deg);
                top: ($input-height - $select-angle-real-size - $select-angle-border-width) / 2;
            }
        }

        .is-checked & {
            color: $white;
            background: $select-color;
            border-color: $select-color;

            &:after {
                border-color: $white;
            }
        }
    }

    &__dropdown {
        display: none;
        padding: 0;
        position: absolute;
        top: 125%;
        left: 0;
        background: $white;
        max-height: $select-dropdown-height;
        opacity: 0;
        z-index: 2;
        @include transition(opacity);

        .is-opened & {
            display: block;
            animation: fadeIn .15s ease-in-out forwards;
        }

        @include mo(xs) {
            display: none;
        }
    }

    &__item {
        display: block;
        color: $text;
        padding: nth($input-padding, 1) * nth($select-item-ratio, 1) nth($input-padding, 2) * nth($select-item-ratio, 2);
        cursor: pointer;
        @include transition(color, background);

        @include mo(xs) {
            padding-left: round(nth($input-padding, 2) * $input-padding-xs-factor);
            padding-right: round(nth($input-padding, 2) * $input-padding-xs-factor);
        }

        @include hover() {
            background: $select-hover-item-bg;
            color: $select-hover-item-color;
        }

        &.is-active {
            background: $select-active-item-bg;
            color: $select-active-item-color;
        }
    }
}

.btn {
    $button-padding-y: nth($input-padding, 1) - ($button-border-width - $input-border-width);
    $button-padding-x: nth($input-padding, 2) - ($button-border-width - $input-border-width);

    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-height: $input-height;
    font-size: $button-font-size;
    outline: 0 !important;
    text-decoration: none!important;
    padding: $button-padding-y * nth($button-ratio-normal, 1) $button-padding-x * nth($button-ratio-normal, 2);
    border: $button-border-width solid;
    border-radius: $button-radius;

    &:focus {
        box-shadow: none!important;
    }

    @include mo(xs) {
        width: 100%;
        padding-left: round($button-padding-x * $button-padding-xs-factor);
        padding-right: round($button-padding-x * $button-padding-xs-factor);
    }

    p + & {
        margin-top: 20px;
    }

    @mixin button-bg($type, $color) {
        $text-color: if($type == 'yellow', $text, $white);

        color: $text-color;
        background: $color;
        border-color: $color;

        @include hover() {
            color: $text-color;
            background: lighten($color, $button-hover-depth);
            border-color: lighten($color, $button-hover-depth);
        }
    };

    @each $type, $color in $colors {
        @if $color == $primary {
            @include button-bg($type, $color);
        } @else {
            &--#{$type} {
                @include button-bg($type, $color);
            }
        }
    }

    &--light {
        background: lighten($primary, 55%);
        color: $text;

        @include hover() {
            color: $text;
            background: lighten($primary, 57%);
        }
    }

    &--white,
    &--border {
        color: $primary;
        background: $white;

        @include hover() {
            color: $white;
            background: lighten($primary, $button-hover-depth);
        }
    }

    &--round {
        border-radius: $button-radius * 10;
        padding-left: $button-padding-x * nth($button-ratio-normal, 2) * nth($button-ratio-round, 2);
        padding-right: $button-padding-x * nth($button-ratio-normal, 2) * nth($button-ratio-round, 2);
    }

    &--square {
        border-radius: 0;
    }

    &--small {
        padding: $button-padding-y * nth($button-ratio-small, 1) $button-padding-x * nth($button-ratio-small, 2);

        &.btn--round {
            padding-left: $button-padding-x * nth($button-ratio-small, 2) * nth($button-ratio-round, 2);
            padding-right: $button-padding-x * nth($button-ratio-small, 2) * nth($button-ratio-round, 2);
        }
    }

    &--large {
        padding: $button-padding-y * nth($button-ratio-large, 1) $button-padding-x * nth($button-ratio-large, 2);

        &.btn--round {
            padding-left: $button-padding-x * nth($button-ratio-large, 2) * nth($button-ratio-round, 2);
            padding-right: $button-padding-x * nth($button-ratio-large, 2) * nth($button-ratio-round, 2);
        }
    }

    &--disabled {
        opacity: $disabled-opacity;
        filter: grayscale(1);
        pointer-events: none;
    }
}

.form {
    &__control {
        width: 100%;
        position: relative;
        margin-bottom: $form-gutter;

        @include mo(xs) {
            margin-bottom: round($form-gutter * 0.75);
        }

        .form__group & {
            flex: 1;
            margin-right: $form-gutter;

            &:last-child {
                margin-right: 0;
            }

            @include ms(lg) {
                flex: 0 1 auto;
                margin-right: 0;
            }
        }
    }

    &__group {
        display: flex;
        flex-wrap: wrap;
    }

    &__submit {
        margin-top: $form-gutter * 1.5;
    }
}
